var fs = require('fs');
var path = require('path');
var myfs = require('myfs');

module.exports = function(){

  //handle dropping files from outside of the application to our applications
  window.ondragover = function(e) { e.preventDefault(); return false;  };
  window.ondrop = function(e) { e.preventDefault(); return false; };

  $(window.document).on('drop', '.folderView, #currentDirectory', function(e){
      e = e.originalEvent;
      e.preventDefault();
      var moveTo = $(this).attr('data-path');

      for (var i = 0; i < e.dataTransfer.files.length; i++){  
        myfs.moveFile(e.dataTransfer.files[i].path, moveTo);
      
      return false;
    });
  
  //handle dragging files out of the browser
  //and dragging files within the browser
  $(window.document).on('dragstart', '.file', function(e){
    e = e.originalEvent;
    
    var filePath = $(this).attr('data-path');
    
    e.dataTransfer.setData("DownloadURL", "application/octet-stream:" + path.basename(filePath) + ":file://" + filePath);
    
    var handler = {
      dragend: function(e){
        e = e.originalEvent;
        $(this).off(handler);
        
        var $droppedOn = window.document.elementFromPoint(e.pageX, e.pageY);
        if ($droppedOn){
          $droppedOn = $($droppedOn);
          if ($droppedOn.hasClass('file'))
            myfs.moveFile(filePath, path.dirname($droppedOn.attr('data-path')));
          else
            myfs.moveFile(filePath, $droppedOn.attr('data-path'));
        }
      }
    };
    
    $(window.document).on(handler);
  });
};