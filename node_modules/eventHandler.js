var fs = require('fs');
var path = require('path');

module.exports = function(){

  //handle dropping files from outside of the application to our applications
  window.ondragover = function(e) { e.preventDefault(); return false;  };
  window.ondrop = function(e) { e.preventDefault(); return false; };

  $(window.document).on('drop', '.folderView, #currentDirectory', function(e){
      e = e.originalEvent;
      e.preventDefault();
      var moveTo = $(this).attr('data-path');

      for (var i = 0; i < e.dataTransfer.files.length; i++){
        console.log(e.dataTransfer.files[i]);
        
        fs.renameSync(e.dataTransfer.files[i].path, path.join(moveTo, e.dataTransfer.files[i].name));
      }

      return false;
    });
  
  
  //handle clicking and dragging the files in the browser
  $(window.document).on('mousedown', '.file', function(e){
    var node = $(this);
    var position = node.offset();
    var initialized = {
        x : position.left - e.pageX,
        y : position.top - e.pageY
    };
    
    var clone = node.clone();
    clone.css('position', 'absolute');
    $('body').append(clone);
    
    var handlers = {
        mousemove : function(e){
            clone.css({
                left : ( initialized.x + e.pageX ) + 'px',
                top : ( initialized.y + e.pageY ) + 'px'
            });
        },
        mouseup : function(e){
            $(this).off(handlers);
            clone.remove();
        }
    };
    $(window.document).on(handlers);
  });
    
};