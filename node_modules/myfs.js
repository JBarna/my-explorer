var chokidar = require('chokidar');
var chokidarOptions = {depth: 2, ignored: /[\/\\]\./};
var path = require('path');
var DOMCtrl = require('DOMController');


exports.cd = function(curdirpath){
  curdirpath = path.resolve(curdirpath);
  var parentPath = path.dirname(curdirpath);
  DOMCtrl.reset();
  
  var parentWatch = chokidar.watch(parentPath, chokidarOptions);
  
  parentWatch.on('addDir', function(dirpath){
    if (dirpath == parentPath)
      DOMCtrl.setParent(dirpath);
    else if(dirpath !== curdirpath){
      if (path.dirname(dirpath) === parentPath) //sibling
        DOMCtrl.addSiblingDirectory(dirpath);
      else if (path.dirname(dirpath) === curdirpath)  //child
        DOMCtrl.addChildDirectory(dirpath);
    }
  });
  
  parentWatch.on('add', function(filePath){
    if (path.dirname(filePath) === curdirpath)
      DOMCtrl.addFileToCurrentDirectory(filePath);
    else
      DOMCtrl.addFileToDirectory(filePath);
  });
  
  parentWatch.on('unlink', function(filePath){
    DOMCtrl.removeFile(filePath);
  });
  
  parentWatch.on('unlinkDir', function(dirPath){
    DOMCtrl.removeFolderView(dirPath);
  });
};
  
  
  