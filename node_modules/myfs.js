var chokidar = require('chokidar');
var chokidarOptions = {depth: 2, ignored: /[\/\\]\./};
var path = require('path');
var DOMCtrl = require('DOMController');
var fs = require('fs');


exports.cd = function(curdirpath){
  curdirpath = path.resolve(curdirpath);
  var parentPath = path.dirname(curdirpath);
  
  DOMCtrl.reset();
  DOMCtrl.setParent(parentPath);
  DOMCtrl.setCurrentDir(curdirpath);
  
  var parentWatch = chokidar.watch(parentPath, chokidarOptions);
  
  parentWatch.on('addDir', function(dirpath){
    if(dirpath !== curdirpath && dirpath !== parentPath){
      if (path.dirname(dirpath) === curdirpath)  //child
        DOMCtrl.addChildDirectory(dirpath);
    }
  });
  
  parentWatch.on('add', function(filePath){
    if (path.dirname(filePath) === curdirpath)
      DOMCtrl.addFileToCurrentDirectory(filePath);
    else
      DOMCtrl.addFileToDirectory(filePath);
  });
  
  parentWatch.on('unlink', function(filePath){
    DOMCtrl.removeFile(filePath);
  });
  
  parentWatch.on('unlinkDir', function(dirPath){
    DOMCtrl.removeFolderView(dirPath);
  });
};

exports.moveFile = function(from, to){
  fs.renameSync(from, path.join(to, path.basename(from)));
};
  
  
  