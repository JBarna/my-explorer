var fs = require('fs');
var path = require('path');

exports.getFiles = function(dirpath, callWithFileStats){
  
  var files = fs.readdirSync(dirpath);
  
  for (file of files){
    var fileStats = fs.statSync(path.join(dirpath, file));
    
    //add the name to the stats object
    fileStats.name = file;
    //if its'a  file and not a hidden file
    if (fileStats.isFile() && path.extname(file))
      callWithFileStats(fileStats);
  
  }
}

exports.getChildDirectories = function(dirpath, callwithDirstats){
  
  var next = function(){
    var files = fs.readdirSync(dirpath);
    for (file of files){
      var fileStats = fs.statSync(path.join(dirpath, file));

      fileStats.name = file;
      if (fileStats.isDirectory())
        callwithDirstats(fileStats);

    }
  }
  process.nextTick(next); //hackish... we should be using events
  //this makes it so we can still executre the code after we've returned the handled.
  return { getFiles: function(dirStat, cb){
    exports.getFiles(path.join(dirpath, dirStat.name), cb);
  }
         }
}